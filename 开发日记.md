#                                            开发日记

### 2025-5-18

信息格式

```c++
 QString account =ui->accountEdit->text();
    QString password =ui->passwordEdit->text();
    QString accInfo =QString("account:%1 password:%2").arg(account,password);
```

从账号信息中提取账号和密码

```cpp
QRegularExpression re("account:(.+?) password:(.+)");
QRegularExpressionMatch match =re.match(accInfo);
if(match.hasMatch()){
    qDebug()<<match.captured(1);
    qDebug()<<match.captured(2);
}
```

服务端监听与数据库连接

```c++
server = new QTcpServer;
server->listen(QHostAddress::AnyIPv4,8000);

db =QSqlDatabase ::addDatabase("QMYSQL");
db.setDatabaseName("mydb");
db.setHostName("localhost");
db.setUserName("root");
db.setPassword("root");
if(db.open()){
    QMessageBox::information(this,"提示","数据库连接成功");
}else{
    QMessageBox::information(this,"提示","数据库连接失败");
}
```

实现当同意协议时才可登录

```c++
void MainWindow::on_aggreButton_clicked()
{
    //登录按钮的变色逻辑
    if(ui->aggreButton->isChecked()){
        ui->LogButton->setStyleSheet("background-color: rgb(0, 170, 255);");
        ui->LogButton->setEnabled(1);
    }else{
         ui->LogButton->setStyleSheet("background-color: rgb(170, 233, 255);");
        ui->LogButton->setEnabled(0);
    }
}
```

拖动事件的处理

```c++
bool DragEvent::eventFilter(QObject* object,QEvent* event){
    auto m =dynamic_cast<QMainWindow*>(object);
    if(!m){
        return false;
    }
    if(event->type()==QEvent::MouseButtonPress){
        auto e =dynamic_cast<QMouseEvent*>(event);
        if(!e)return false;
        mousePoint=e->pos();//记录鼠标按下位置
    }else if(event->type()==QEvent::MouseMove){
        auto e=dynamic_cast<QMouseEvent*>(event);
        if(!e)return false;
        if(e->buttons()&Qt::MouseButton::LeftButton){
            m->move(e->globalPosition().toPoint()-mousePoint);
        }
    }
    return QObject::eventFilter(object,event);
}
```

